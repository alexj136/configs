#!/bin/sh
# AUR package updater

# Check wget is installed, quit if not
command -v wget >/dev/null 2>&1 || {
    echo "Command 'wget' required but not found.  Aborting." >&2
    exit 1
}

# Check sudo is installed, quit if not
command -v sudo >/dev/null 2>&1 || {
    echo "Command 'sudo' required but not found.  Aborting." >&2
    exit 1
}

# Create the package cache if it doesn't exist already
mkdir -p .aur-pkgs

# Pushd to the cache
pushd ~/.aur-pkgs/

for package in $(cat ~/.aur-pkg-list); do

    # Uninstall the old package
    sudo pacman -Rsn $package

    # Delete old package files from the cache
    rm -rf $package/ $package.tar.gz

    # Download new package files
    wget https://aur.archlinux.org/cgit/aur.git/snapshot/$package.tar.gz

    # Unpack
    tar -xvf $package.tar.gz

    # Pushd to the unpacked package
    pushd $package/

    # Install the package
    makepkg -sri

    # Return to the package directory
    popd
done

# Return to the original directory
popd
